<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Papucholangas</title>

<style>
body{
font-family:Arial;
background:#0f0f0f;
color:white;
margin:0;
}

header{
background:#ff6a00;
padding:20px;
text-align:center;
font-size:22px;
font-weight:bold;
}

section{padding:20px;}

input,select,button{
padding:8px;
margin:5px;
}

button{
background:#ff6a00;
border:none;
color:white;
cursor:pointer;
}

ul{list-style:none;padding:0;}

li{
background:#1a1a1a;
margin:8px 0;
padding:10px;
border-radius:8px;
display:flex;
justify-content:space-between;
align-items:center;
}

.hecho{text-decoration:line-through;opacity:0.5;}

.matematicas{border-left:5px solid #00ff88;}
.fisica{border-left:5px solid #00c3ff;}
.castellano{border-left:5px solid #ff4d4d;}
.bioquimica{border-left:5px solid #a64dff;}
.filosofia{border-left:5px solid yellow;}
.ingles{border-left:5px solid pink;}
.taller{border-left:5px solid #00ffcc;}
.baloncesto{border-left:5px solid orange;}
.otro{border-left:5px solid gray;}

.progreso{
height:20px;
background:#333;
border-radius:10px;
margin-top:10px;
}

.barra{
height:20px;
background:#00ff88;
border-radius:10px;
width:0%;
transition:0.3s;
}

.oculto{display:none;}

.login{
display:flex;
flex-direction:column;
align-items:center;
justify-content:center;
height:100vh;
}
</style>
</head>

<body>

<div id="login" class="login">
<h2>Papucholangas ON</h2>
<input type="password" id="clave" placeholder="Contrase√±a">
<button onclick="entrar()">Entrar</button>
</div>

<div id="app" class="oculto">

<header>
Sistema Supremo Barrera & Tuta üöÄüî•
</header>

<section>

<button onclick="modoEnfoque()">Modo Enfoque</button>

<h3>Agregar Tarea</h3>

<select id="materia" onchange="mostrarProfe()">
<option>Matem√°ticas</option>
<option>F√≠sica</option>
<option>Castellano</option>
<option>Bioqu√≠mica</option>
<option>Filosof√≠a</option>
<option>Ingl√©s</option>
<option>Taller</option>
<option>Baloncesto (Edu F√≠sica)</option>
<option>Dibujo</option>
<option>C. Pol√≠ticas</option>
<option>Religi√≥n</option>
<option>Inform√°tica</option>
</select>

<select id="profe" style="display:none;">
<option>Yecid</option>
<option>Zabaleta</option>
<option>Barbosa</option>
</select>

<input type="text" id="texto" placeholder="Escribe la tarea...">
<button onclick="agregar()">Agregar</button>

<h3>Tareas</h3>
<ul id="lista"></ul>

<div id="contador"></div>

<div class="progreso">
<div class="barra" id="barra"></div>
</div>

<div id="racha"></div>

</section>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, push, onValue, remove, update } 
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyD8Z8M5TL-SU3oMFYULFaIzhBrD9yObXwo",
  authDomain: "papucholangas.firebaseapp.com",
  databaseURL: "https://papucholangas-default-rtdb.firebaseio.com",
  projectId: "papucholangas",
  storageBucket: "papucholangas.firebasestorage.app",
  messagingSenderId: "392558100266",
  appId: "1:392558100266:web:eb3a5313670bcafba96853"
};

const appFirebase = initializeApp(firebaseConfig);
const db = getDatabase(appFirebase);
const tareasRef = ref(db,"tareas");

let contrase√±a="Papucholangas";

window.entrar=function(){
let c=document.getElementById("clave").value;
if(c===contrase√±a){
document.getElementById("login").style.display="none";
document.getElementById("app").classList.remove("oculto");
}else{
alert("Clave incorrecta");
}
}

window.mostrarProfe=function(){
let m=document.getElementById("materia").value;
document.getElementById("profe").style.display=(m==="Taller")?"inline":"none";
}

window.agregar=function(){
let materia=document.getElementById("materia").value;
let texto=document.getElementById("texto").value;
let profe=document.getElementById("profe").value;

if(texto==="") return;

push(tareasRef,{
materia,
texto,
profe:(materia==="Taller")?profe:"",
hecho:false
});

document.getElementById("texto").value="";
}

onValue(tareasRef,(snapshot)=>{
let lista=document.getElementById("lista");
lista.innerHTML="";
let pendientes=0;
let hechas=0;

snapshot.forEach(child=>{
let t=child.val();
let key=child.key;

let li=document.createElement("li");
let clase=t.materia.toLowerCase();

if(clase.includes("matem")) clase="matematicas";
else if(clase.includes("fis")) clase="fisica";
else if(clase.includes("cast")) clase="castellano";
else if(clase.includes("bio")) clase="bioquimica";
else if(clase.includes("filo")) clase="filosofia";
else if(clase.includes("ingles")) clase="ingles";
else if(clase.includes("taller")) clase="taller";
else if(clase.includes("baloncesto")) clase="baloncesto";
else clase="otro";

li.classList.add(clase);

if(t.hecho){li.classList.add("hecho");hechas++;}else{pendientes++;}

li.innerHTML=`<span><strong>[${t.materia}${t.profe?" - "+t.profe:""}]</strong> ${t.texto}</span>`;

let botones=document.createElement("div");

let check=document.createElement("button");
check.textContent="‚úî";
check.onclick=()=>marcar(key,t.hecho);

let borrar=document.createElement("button");
borrar.textContent="üóë";
borrar.onclick=()=>remove(ref(db,"tareas/"+key));

botones.appendChild(check);
botones.appendChild(borrar);
li.appendChild(botones);
lista.appendChild(li);
});

document.getElementById("contador").textContent="Pendientes: "+pendientes;

let total=pendientes+hechas;
let porcentaje=total? (hechas/total)*100:0;
document.getElementById("barra").style.width=porcentaje+"%";

actualizarRacha(hechas);
});

window.marcar=function(key,estado){
update(ref(db,"tareas/"+key),{hecho:!estado});
}

window.modoEnfoque=function(){
document.body.style.background=
(document.body.style.background==="black")?"#0f0f0f":"black";
}

function actualizarRacha(hechas){
let hoy=new Date().toDateString();
let data=JSON.parse(localStorage.getItem("racha"))||{dia:hoy,valor:0};

if(hechas>0){
if(data.dia!==hoy){
data.valor++;
data.dia=hoy;
}
}else{
data.valor=0;
}

localStorage.setItem("racha",JSON.stringify(data));
document.getElementById("racha").textContent="Racha de disciplina üî•: "+data.valor+" d√≠as";
}
</script>

</body>
</html>
